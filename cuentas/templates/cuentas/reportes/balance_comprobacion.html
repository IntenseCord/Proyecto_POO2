{% extends 'base.html' %}

{% block title %}Balance de Comprobación{% endblock %}
{% block page_title %}Balance de Comprobación{% endblock %}

{% block extra_css %}
<style>
    .filtros-card {
        background: white;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        margin-bottom: 30px;
    }
    
    .form-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: #2c3e50;
    }
    
    .form-control {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 8px;
    }
    
    .btn-generar {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 12px 30px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
    }
    
    .btn-generar:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }
    
    .reporte-header {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        margin-bottom: 20px;
        text-align: center;
    }
    
    .reporte-header h2 {
        color: #2c3e50;
        margin-bottom: 10px;
    }
    
    .reporte-header p {
        color: #7f8c8d;
        margin: 5px 0;
    }
    
    .tabla-reporte {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        overflow: hidden;
    }
    
    .tabla-reporte table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .tabla-reporte th {
        background: #f8f9fa;
        padding: 15px;
        text-align: left;
        font-weight: 600;
        color: #2c3e50;
        border-bottom: 2px solid #e9ecef;
    }
    
    .tabla-reporte td {
        padding: 12px 15px;
        border-bottom: 1px solid #f0f0f0;
    }
    
    .tabla-reporte tr:hover {
        background: #f8f9fa;
    }
    
    .text-right {
        text-align: right;
    }
    
    .totales-row {
        background: #667eea !important;
        color: white !important;
        font-weight: 700;
    }
    
    .totales-row td {
        border-bottom: none !important;
    }
    
    .alert-success {
        background: #d4edda;
        color: #155724;
        padding: 15px;
        border-radius: 8px;
        margin-top: 20px;
    }
    
    .alert-danger {
        background: #f8d7da;
        color: #721c24;
        padding: 15px;
        border-radius: 8px;
        margin-top: 20px;
    }
</style>
{% endblock %}

{% block content %}
<div class="filtros-card">
    <h3 style="margin-bottom: 20px;"><i class="fas fa-filter"></i> Filtros del Reporte</h3>
    <form method="GET">
        <div class="form-row">
            <div class="form-group">
                <label for="empresa_id">Empresa *</label>
                <select name="empresa_id" id="empresa_id" class="form-control" required>
                    <option value="">Seleccione una empresa</option>
                    {% for empresa in empresas %}
                    <option value="{{ empresa.id }}">{{ empresa.nombre }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <label for="fecha_inicio">Fecha Inicio</label>
                <input type="date" name="fecha_inicio" id="fecha_inicio" class="form-control">
            </div>
            
            <div class="form-group">
                <label for="fecha_fin">Fecha Fin</label>
                <input type="date" name="fecha_fin" id="fecha_fin" class="form-control">
            </div>
        </div>
        
        <button type="submit" class="btn-generar">
            <i class="fas fa-chart-bar"></i> Generar Reporte
        </button>
    </form>
</div>

{% if reporte %}
<div class="reporte-header">
    <h2>{{ reporte.empresa.nombre }}</h2>
    <p><strong>Balance de Comprobación</strong></p>
    {% if reporte.fecha_inicio and reporte.fecha_fin %}
    <p>Del {{ reporte.fecha_inicio|date:"d/m/Y" }} al {{ reporte.fecha_fin|date:"d/m/Y" }}</p>
    {% else %}
    <p>Todos los períodos</p>
    {% endif %}
</div>

<div class="tabla-reporte">
    <table>
        <thead>
            <tr>
                <th>Código</th>
                <th>Cuenta</th>
                <th class="text-right">Débitos</th>
                <th class="text-right">Créditos</th>
                <th class="text-right">Saldo Deudor</th>
                <th class="text-right">Saldo Acreedor</th>
            </tr>
        </thead>
        <tbody>
            {% for cuenta in reporte.cuentas %}
            <tr>
                <td>{{ cuenta.codigo }}</td>
                <td>{{ cuenta.nombre }}</td>
                <td class="text-right">${{ cuenta.debito|floatformat:2 }}</td>
                <td class="text-right">${{ cuenta.credito|floatformat:2 }}</td>
                <td class="text-right">${{ cuenta.saldo_deudor|floatformat:2 }}</td>
                <td class="text-right">${{ cuenta.saldo_acreedor|floatformat:2 }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" style="text-align: center; padding: 30px; color: #7f8c8d;">
                    No hay movimientos en el período seleccionado
                </td>
            </tr>
            {% endfor %}
            
            {% if reporte.cuentas %}
            <tr class="totales-row">
                <td colspan="2"><strong>TOTALES</strong></td>
                <td class="text-right"><strong>${{ reporte.totales.debitos|floatformat:2 }}</strong></td>
                <td class="text-right"><strong>${{ reporte.totales.creditos|floatformat:2 }}</strong></td>
                <td class="text-right"><strong>${{ reporte.totales.saldo_deudor|floatformat:2 }}</strong></td>
                <td class="text-right"><strong>${{ reporte.totales.saldo_acreedor|floatformat:2 }}</strong></td>
            </tr>
            {% endif %}
        </tbody>
    </table>
</div>

{% if reporte.esta_balanceado %}
<div class="alert-success">
    <i class="fas fa-check-circle"></i> <strong>Balance Correcto:</strong> Los débitos y créditos están balanceados.
</div>
{% else %}
<div class="alert-danger">
    <i class="fas fa-exclamation-triangle"></i> <strong>Advertencia:</strong> Los débitos y créditos NO están balanceados. Revise los asientos contables.
</div>
{% endif %}
{% endif %}
{% endblock %}
