{% extends 'base.html' %}

{% block title %}Balance de Comprobación{% endblock %}

{% block page_title %}Balance de Comprobación{% endblock %}

{% block extra_css %}
{% include 'cuentas/reportes/_estilos_reporte.html' %}

<style>
  .tabla-reporte {
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
    overflow: hidden;
  }

  .tabla-reporte table {
    width: 100%;
    border-collapse: collapse;
  }

  .tabla-reporte th {
    background: #f8f9fa;
    padding: 15px;
    text-align: left;
    font-weight: 600;
    color: #2c3e50;
    border-bottom: 2px solid #e9ecef;
  }

  .tabla-reporte td {
    padding: 12px 15px;
    border-bottom: 1px solid #f0f0f0;
  }

  .tabla-reporte tr:hover {
    background: #f8f9fa;
  }

  .text-right {
    text-align: right;
  }

  .totales-row {
    background: #667eea !important;
    color: white !important;
    font-weight: 700;
  }

  .totales-row td {
    border-bottom: none !important;
  }
</style>
{% endblock %}

{% block content %}
<div class="filtros-card">
  <h3 style="margin-bottom: 20px">
    <i class="fas fa-filter"></i> Filtros del Reporte
  </h3>
  <form method="GET">
    <div class="form-row">
      <div class="form-group">
        <label for="fecha_inicio">Fecha Inicio</label>
        <input
          type="date"
          name="fecha_inicio"
          id="fecha_inicio"
          class="form-control"
          value="{{ request.GET.fecha_inicio }}"
        />
      </div>

      <div class="form-group">
        <label for="fecha_fin">Fecha Fin</label>
        <input
          type="date"
          name="fecha_fin"
          id="fecha_fin"
          class="form-control"
          value="{{ request.GET.fecha_fin }}"
        />
      </div>

      <div class="form-group">
        <label for="tipo_cuenta">Tipo de Cuenta</label>
        <select name="tipo_cuenta" id="tipo_cuenta" class="form-control">
          <option value="">Todos los tipos</option>
          {% for tipo_value, tipo_label in tipos_cuenta %}
          <option value="{{ tipo_value }}" {% if tipo_cuenta_seleccionado == tipo_value %}selected{% endif %}>
            {{ tipo_label }}
          </option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div style="display: flex; gap: 10px;">
      <button type="submit" name="generar" class="btn-generar">
        <i class="fas fa-chart-bar"></i>
        Generar Reporte
      </button>
      
      {% if reporte %}
      <a href="{% url 'cuentas:balance_comprobacion_pdf' %}?fecha_inicio={{ request.GET.fecha_inicio }}&fecha_fin={{ request.GET.fecha_fin }}&tipo_cuenta={{ request.GET.tipo_cuenta }}" 
         class="btn-generar" 
         style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); text-decoration: none; display: inline-flex; align-items: center;">
        <i class="fas fa-file-pdf"></i>
        Exportar a PDF
      </a>
      {% endif %}
    </div>
  </form>
</div>

{% if reporte %}
{% include 'cuentas/reportes/_encabezado_reporte.html' with titulo='Balance de Comprobación' %}

<div class="tabla-reporte">
  <table>
    <thead>
      <tr>
        <th scope="col">Código</th>
        <th scope="col">Cuenta</th>
        <th scope="col" class="text-right">Débitos</th>
        <th scope="col" class="text-right">Créditos</th>
        <th scope="col" class="text-right">Saldo Deudor</th>
        <th scope="col" class="text-right">Saldo Acreedor</th>
      </tr>
    </thead>
    <tbody>
      {% for cuenta in reporte.cuentas %}
      <tr>
        <td>{{ cuenta.codigo }}</td>
        <td>{{ cuenta.nombre }}</td>
        <td class="text-right">${{ cuenta.debito|floatformat:2 }}</td>
        <td class="text-right">${{ cuenta.credito|floatformat:2 }}</td>
        <td class="text-right">${{ cuenta.saldo_deudor|floatformat:2 }}</td>
        <td class="text-right">${{ cuenta.saldo_acreedor|floatformat:2 }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6" style="text-align: center; padding: 30px; color: #7f8c8d">
          No hay movimientos en el período seleccionado
        </td>
      </tr>
      {% endfor %}
      
      {% if reporte.cuentas %}
      <tr class="totales-row">
        <td colspan="2"><strong>TOTALES</strong></td>
        <td class="text-right">
          <strong>${{ reporte.totales.debitos|floatformat:2 }}</strong>
        </td>
        <td class="text-right">
          <strong>${{ reporte.totales.creditos|floatformat:2 }}</strong>
        </td>
        <td class="text-right">
          <strong>${{ reporte.totales.saldo_deudor|floatformat:2 }}</strong>
        </td>
        <td class="text-right">
          <strong>${{ reporte.totales.saldo_acreedor|floatformat:2 }}</strong>
        </td>
      </tr>
      {% endif %}
    </tbody>
  </table>
</div>

{% if reporte.esta_balanceado %}
<div class="alert-success">
  <i class="fas fa-check-circle"></i> 
  <strong>Balance Correcto:</strong> Los débitos y créditos están balanceados.
</div>
{% else %}
<div class="alert-danger">
  <i class="fas fa-exclamation-triangle"></i> 
  <strong>Advertencia:</strong> Los débitos y créditos NO están balanceados. Revise los asientos contables.
</div>
{% endif %}

{% endif %}

{% endblock %}
