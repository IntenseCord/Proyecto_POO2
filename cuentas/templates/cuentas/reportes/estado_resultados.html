{% extends 'base.html' %}

{% block title %}Estado de Resultados{% endblock %}

{% block page_title %}Estado de Resultados{% endblock %}

{% block extra_css %}
{% include 'cuentas/reportes/_estilos_reporte.html' with btn_gradient='linear-gradient(135deg, #11998e 0%, #38ef7d 100%)' hover_shadow='rgba(17, 153, 142, 0.3)' %}

<style>
  .subtotal {
    display: flex;
    justify-content: space-between;
    padding: 15px 0;
    margin-top: 10px;
    border-top: 2px solid #e9ecef;
    font-weight: 600;
    color: #2c3e50;
  }

  .total-final {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    padding: 20px;
    border-radius: 8px;
    margin-top: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .total-final.perdida {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  }

  .total-final h3 {
    margin: 0;
    font-size: 24px;
  }

  .total-final .monto {
    font-size: 32px;
    font-weight: 700;
  }

  .resultado-badge {
    display: inline-block;
    padding: 8px 20px;
    border-radius: 20px;
    font-weight: 600;
    font-size: 14px;
  }

  .resultado-badge.utilidad {
    background: #d4edda;
    color: #155724;
  }

  .resultado-badge.perdida {
    background: #f8d7da;
    color: #721c24;
  }
</style>
{% endblock %}

{% block content %}
{% include 'cuentas/reportes/_filtros_reporte.html' with btn_icon='fa-chart-line' btn_text='Generar Reporte' %}

{% if reporte %}
{% include 'cuentas/reportes/_encabezado_reporte.html' with titulo='Estado de Resultados' mostrar_badge=True %}

<!-- Ingresos -->
<div class="seccion-reporte">
  <h3><i class="fas fa-arrow-up" style="color: #38ef7d"></i> Ingresos</h3>
  {% include 'cuentas/reportes/_lista_cuentas.html' with
  cuentas=reporte.ingresos mensaje_vacio='No hay ingresos en el período'
  mostrar_total=True label_total='Total Ingresos'
  valor_total=reporte.totales.ingresos %}
</div>

<!-- Costos -->
<div class="seccion-reporte">
  <h3><i class="fas fa-minus-circle" style="color: #f5576c"></i> Costos</h3>
  {% include 'cuentas/reportes/_lista_cuentas.html' with cuentas=reporte.costos
  mensaje_vacio='No hay costos en el período' mostrar_total=True
  label_total='Total Costos' valor_total=reporte.totales.costos %}

  <div
    class="subtotal"
    style="
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    "
  >
    <span><strong>Utilidad Bruta</strong></span>
    <span
      ><strong
        >${{ reporte.totales.utilidad_bruta|floatformat:2 }}</strong
      ></span
    >
  </div>
</div>

<!-- Gastos -->
<div class="seccion-reporte">
  <h3>
    <i class="fas fa-arrow-down" style="color: #f093fb"></i> Gastos
    Operacionales
  </h3>
  {% include 'cuentas/reportes/_lista_cuentas.html' with cuentas=reporte.gastos
  mensaje_vacio='No hay gastos en el período' mostrar_total=True
  label_total='Total Gastos' valor_total=reporte.totales.gastos %}
</div>

<!-- Resultado Final -->
<div
  class="total-final {% if reporte.totales.utilidad_neta < 0 %}perdida{% endif %}"
>
  <div>
    <h3>
      {% if reporte.totales.utilidad_neta > 0 %}
      <i class="fas fa-smile"></i> Utilidad Neta {% else %}
      <i class="fas fa-frown"></i> Pérdida Neta {% endif %}
    </h3>
    <p style="margin: 0; opacity: 0.9">Resultado del Período</p>
  </div>
  <div class="monto">${{ reporte.totales.utilidad_neta|floatformat:2 }}</div>
</div>

{% endif %}
{% endblock %}
